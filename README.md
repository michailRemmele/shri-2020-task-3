# Яндекс ШРИ. Задание 3. Поиск и исправление ошибок


## Ход работы

Для начала я попробовал запустить проект при помощи клавиши **F5** чтобы посмотреть как будет работать приложение.
При первом запуске я получил несколько ошибок в консоль VSCode. Обе относились к файлу server.ts.
Открыв файл я увидел, что в его основе лежит зависимость под названием **vscode-languageserver**. Я бегло посмотрел выдачу в поисковике об этой штуке. Насколько я понял это некий набор средств, который помогает подружить язык на котором хочется писать с IDE в которой хочется работать. Под языком в данном случае подразумевается BEMJSON? Посмотрим.
Расширение представлено сервером и клиентом. Клиент - это видимо наш плагин для VSCode, который обращается к серверу, который будет помогать в работе нашего плагина.

Далее я начал по немногу читать документацию по Language Server и обратил внимание, что все начинается с файла extension.ts. Его я и решил изучить, попутно исправляя всякие стилистические ошибки, будь то пропущенная точка с запятой или лишняя неиспользумая переменная.

В ходе чтения extension.ts наткнулся на ошибку в openPreview функции: сокращенная if конструкция без фигурных скобок и после этого сразу же идет else. Не уверен, если честно, в том, что такой код будет нерабочим, но как минимум выглядит странно. Лучше исправить чтобы не забыть.
Также, в той же функции внутри if else конструкции повторно объявляется константа panel. В таком случае можно объявить выше panel как let и потом записать в нее же создание нового panel если его еще нет.

Хм ну ладно. В extension.ts похоже происходит что-то вроде настройки клиента, т.е. плагина для VSCode. Определены всякие функции для работы панели с превью и тд. К этому еще вернемся. Тогда можно взяться за server.ts и разобраться что же там за ошибки. Как обычно попутно исправляя всякие стилистические косяки.

Первая проблема, которую подчеркнула красным IDE при попытке запуска проекта: это ошибка в возвращаемом значении в коллбэке, который передается в conn.onInitialize. Параметр capabilities.textDocumentSync принимает на вход либо число, либо нечто с типом TextDocumentSyncOptions. Глянув на примеры настройки сервера в интернете, я увидел, что обычно туда передают syncKind свойство из экземпляра класса TextDocuments. По описанию похож на тот самый "always", который там стоял ранее. Попробуем поставить его.

Вторая проблема была в функции validateTextDocument. Там что-то не то передается в параметр location, который используется для того, чтобы показать где в JSON-е ошибка. Похоже в AstIdentifier такого значения нет, хотя вспоминая прошлое задание, в json-to-ast такое поле было вроде как у каждой сущности. Проверим, может забыли что в интерфейсе указать. Да, так и есть, в интерфейсе это поле пропустили. Ну ничего, добавим.

Ну похоже проект наконец-то завелся. Попробуем взять какой-нибудь BEMJSON из первого задания и посмотрит как будет работать расширение.


## Задание

**Дан исходный код приложения, в котором есть ошибки. Одни ошибки — стилистические, а другие не позволят даже запустить приложение. Вам нужно найти все ошибки и исправить их.**

Тестовое приложение — это плагин VS Code для удобного прототипирования интерфейсов с помощью дизайн-системы из первого задания. Вы можете описать в файле `.json` блоки, из которых состоит интерфейс. Плагин добавляет превью (1) и линтер (2) для структуры блоков.

![скриншот интерфейса](extension.png)

### Превью интерфейса

- Превью интерфейса доступно для всех файлов `.json`.
- Превью открывается в отдельной вкладке:
  - при выполнении команды `Example: Show preview` через палитру команд;
  - при нажатии кнопки сверху от редактора (см. скриншот);
  - при нажатии горячих клавиш **⌘⇧V** (для macOS) или **Ctrl+Shift+V** (для Windows).
- Вкладка превью должна открываться рядом с текущим редактором.
- Если превью уже открыто, то должна открываться уже открытая вкладка, новая открываться не должна.
- Когда пользователь изменяет в редакторе структуру блоков, превью должно обновляться
- Сейчас превью отображает структуру блоков в виде прямоугольников. Реализуйте отображение превью с помощью вёрстки и JS из первого задания.

### Линтер структуры блоков

- Линтер применяется для всех файлов `.json`.
- Линтер подсвечивает ошибочное место в файле и отображает сообщение при наведении мыши.
- Линтер отображает сообщения на панели `Problems` (**⌘⇧M** для macOS или **Ctrl+Shift+M** для Windows), сообщения группируются по файлам, при клике происходит переход к ошибочному месту.
- Сейчас плагин использует линтер-заглушку, проверяющий всего два правила: 1) «запрещены названия полей в верхнем регистре»; 2) «в каждом объекте должно быть поле `block`». Подключите в проект линтер из второго задания.

### Настройки

Плагин добавляет в настройки VS Code новый раздел `Example` с параметрами:

- `example.enable` — использовать линтер;
- `example.severity.uppercaseNamesIsForbidden` — тип сообщения для правила «Запрещены названия полей в верхнем регистре»;
- `example.severity.blockNameIsRequired` — тип сообщения для правила «В каждом объекте должно быть поле `block`».

Типы сообщений: `Error`, `Warning`, `Information`, `Hint`.

При изменении конфигурации новые настройки должны применяться к работе линтера.

## Как запустить

1. Открыть проект в VS Code.
2. Запустить `npm i`.
3. Нажать **F5**.

Должно открыться ещё одно окно VS Code с подключённым плагином.
